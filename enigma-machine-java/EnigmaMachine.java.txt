public class EnigmaMachine {

    private Rotor rotor1;
    private Rotor rotor2;
    private Rotor rotor3;
    private Reflector reflector;

    public EnigmaMachine(Rotor r1, Rotor r2, Rotor r3, Reflector reflector) {
        this.rotor1 = r1;
        this.rotor2 = r2;
        this.rotor3 = r3;
        this.reflector = reflector;
    }

    public char encryptChar(char c) {
        if (!Character.isLetter(c)) {
            return c;
        }

        c = Character.toUpperCase(c);

        // Step rotors
        rotor1.rotate();
        if (rotor1.forward('A') == 'A') {
            rotor2.rotate();
        }

        // Forward pass
        c = rotor1.forward(c);
        c = rotor2.forward(c);
        c = rotor3.forward(c);

        // Reflect
        c = reflector.reflect(c);

        // Backward pass
        c = rotor3.backward(c);
        c = rotor2.backward(c);
        c = rotor1.backward(c);

        return c;
    }

    public String encryptMessage(String message) {
        StringBuilder result = new StringBuilder();

        for (char c : message.toCharArray()) {
            result.append(encryptChar(c));
        }

        return result.toString();
    }
}
